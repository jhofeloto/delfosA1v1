{% extends "base.html" %}

{% block title %}Resultados de Carga - Pipeline DM2{% endblock %}

{% block content %}
<div class="col-12">
    <div class="gradient-bg rounded-3 p-4 mb-4">
        <h1 class="display-5 fw-bold mb-2">
            <i class="fas fa-check-circle me-3"></i>
            Predicciones Completadas
        </h1>
        <p class="lead mb-0">Resultados del procesamiento masivo de {{ total_rows }} pacientes</p>
    </div>

    <div class="alert alert-success">
        <i class="fas fa-download me-2"></i>
        Archivo procesado guardado como: <strong>{{ filename }}</strong>
    </div>

    <!-- Resumen -->
    <div class="row mb-4">
        <div class="col-md-4">
            <div class="card text-center">
                <div class="card-body">
                    <h3 class="text-primary">{{ total_rows }}</h3>
                    <p class="card-text">Total Pacientes</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card text-center">
                <div class="card-body">
                    <h3 class="text-success">{{ (df['Prediccion'] == 'Normal').sum() if df is not none else 0 }}</h3>
                    <p class="card-text">Normal</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card text-center">
                <div class="card-body">
                    <h3 class="text-warning">{{ (df['Prediccion'] == 'Prediabetes').sum() if df is not none else 0 }}</h3>
                    <p class="card-text">Prediabetes</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Primeros resultados -->
    {% if df is not none %}
    <div class="card">
        <div class="card-header">
            <h5 class="mb-0">Primeros {{ df|length }} Resultados</h5>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                {{ df.to_html(classes='table table-striped table-hover', table_id='resultsTable')|safe }}
            </div>
        </div>
    </div>
    {% endif %}

    <div class="mt-3">
        <a href="{{ url_for('upload_file') }}" class="btn btn-primary">
            <i class="fas fa-upload me-2"></i>Procesar Otro Archivo
        </a>
        <a href="{{ url_for('index') }}" class="btn btn-secondary">
            <i class="fas fa-home me-2"></i>Volver al Inicio
        </a>
    </div>
</div>
{% endblock %}